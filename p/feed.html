<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Feed RSS Reader</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS remains unchanged */
        

.html {
scroll: smooth;
}



* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            margin-bottom: 0;
        }
        
        /* Header and Banner */
        header {
            text-align: center;
            margin-bottom: 0px;
            padding: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .description {
            color: #7f8c8d;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Banners */
        .dashboard-banner {
            height: 250px;
            background-image: url('https://bucket.mlcdn.com/a/3336/3336910/images/00eaeb3a7f94b417c1df5b0b97aa164a34a2ed97.png');
            background-size: cover; 
            background-position: center; 
            border-radius: 12px;
            margin-bottom: 0.5rem;
        }
        
        /* RSS URL Display */
        .rss-url-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .rss-url-display h3 {
            color: #f58025;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .rss-url-display h3 i {
            font-size: 1.2rem;
        }
        
        .url-list {
            margin-bottom: 15px;
        }
        
        .url-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .url-text {
            flex-grow: 1;
            font-family: monospace;
            font-size: 0.9rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 70%;
        }
        
        .url-full {
            display: none;
        }
        
        .url-actions {
            display: flex;
            gap: 8px;
        }
        
        .url-btn {
            background: #f58025;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s ease;
        }
        
        .url-btn:hover {
            background: #e5721b;
        }
        
        .url-btn.remove {
            background: #e74c3c;
        }
        
        .url-btn.remove:hover {
            background: #c0392b;
        }
        
        .add-url-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .url-input {
            flex-grow: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .url-submit {
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 15px;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }
        
        .url-submit:hover {
            background: #27ae60;
        }
        
        /* Search */
        .search-container {
            max-width: 600px;
            margin: 30px auto;
            position: relative;
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            padding-left: 50px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-box:focus {
            box-shadow: 0 5px 15px rgba(245, 128, 37, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #bbb;
        }
        
        /* Sections */
        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaecef;
        }
        
        .section-title {
            color: #2c3e50;
            font-size: 1.5rem;
        }
        
        .view-all {
            color: #f58025;
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 420px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            flex-shrink: 0;
            background-color: #eaecef; /* Fallback if no image */
        }
        
        .card-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .card-subtitle {
            color: #7f8c8d;
            font-size: 0.95rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
        }
        
        .card-meta {
            display: flex;
            justify-content: space-between;
            color: #95a5a6;
            font-size: 0.85rem;
            margin-top: 15px;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .tag {
            background: #fef2e9;
            color: #f58025;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Buttons */
        .load-more {
            display: block;
            margin: 30px auto;
            padding: 12px 25px;
            background: #f58025;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease;
        }
        
        .load-more:hover {
            background: #e5721b;
        }
        
        .section-load-more {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            background: #f58025;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
            width: 100%;
        }
        
        .section-load-more:hover {
            background: #e5721b;
        }
        
        /* Mobile styles */
        .mobile-carousel {
            display: none;
        }
        
        .carousel-container {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            display: flex;
            gap: 15px;
            padding: 10px 0;
            margin: 0 -10px;
            padding: 10px 15px;
        }
        
        .carousel-container::-webkit-scrollbar {
            display: none;
        }
        
        .carousel-card {
            scroll-snap-align: start;
            flex: 0 0 85%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            height: 400px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }
        
        /* Loading animation */
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #f58025;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No results message */
        .no-results {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            grid-column: 1 / -1;
        }
        
        /* Error message */
        .error-message {
            text-align: center;
            padding: 20px;
            color: #e74c3c;
            background: #fdedec;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        /* Highlighting search terms */
        .highlight {
            background-color: rgba(245, 128, 37, 0.2);
            padding: 0 2px;
            border-radius: 3px;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .cards-container {
                display: none;
            }
            
            .mobile-carousel {
                display: block;
                margin: 0 -15px;
                padding: 0 15px;
            }
            
            .carousel-container {
                margin: 0 -15px;
                padding: 10px 15px;
            }
            
            .card-image {
                height: 150px;
            }
            
            .search-box {
                padding: 12px 15px;
                padding-left: 45px;
            }
            
            .dashboard-banner {
                height: 120px;
                margin: 0 -15px 2rem;
                border-radius: 0;
            }
            
            .add-url-container {
                flex-direction: column;
            }
            
            .url-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .url-text {
                max-width: 100%;
            }
            
            .url-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="dashboard-banner"></div>
        </header>

        <!-- RSS URL Management Section -->
        <div class="rss-url-display">
            <h3><i class="fas fa-rss"></i> Manage RSS Feeds</h3>
            
            <div class="url-list" id="url-list">
                <div class="url-item" data-feed-id="dental-practice">
                    <span class="url-text">https://www.drbicuspid.com/__rss/website-scheduled-content.xml?input=%7B%22sectionAlias%22%3A%22dental-practice%22%7D</span>
                    <span class="url-full">https://www.drbicuspid.com/__rss/website-scheduled-content.xml?input=%7B%22sectionAlias%22%3A%22dental-practice%22%7D</span>
                    <div class="url-actions">
                        <button class="url-btn">View</button>
                        <button class="url-btn remove">Remove</button>
                    </div>
                </div>
                <div class="url-item" data-feed-id="allon4-implants">
                    <span class="url-text">https://www.reddit.com/r/Allon4ImplantDentures/.rss</span>
                    <span class="url-full">https://www.reddit.com/r/Allon4ImplantDentures/.rss</span>
                    <div class="url-actions">
                        <button class="url-btn">View</button>
                        <button class="url-btn remove">Remove</button>
                    </div>
                </div>
                <!-- More URLs will be added here dynamically -->
            </div>
            
            <div class="add-url-container">
                <input type="text" class="url-input" id="new-rss-url" placeholder="Enter RSS feed URL">
                <button class="url-submit" id="add-url">Add RSS Feed</button>
            </div>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search-input" class="search-box" placeholder="Search across all feeds...">
        </div>
        
        <div id="feeds-container">
            <!-- Feed sections will be added here dynamically -->
            
            <section class="section" data-feed="dental-practice">
                <div class="section-header">
                    <h2 class="section-title">Dental Practice News</h2>
                    <a href="https://www.drbicuspid.com/dental-practice" class="view-all" target="_blank">View All</a>
                </div>
                
                <div class="cards-container" id="dental-practice-news">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading dental practice news...</p>
                    </div>
                </div>
                
                <div class="mobile-carousel">
                    <div class="carousel-container" id="dental-practice-carousel">
                        <!-- Mobile carousel content will be loaded here -->
                    </div>
                </div>
                
                <button class="section-load-more" data-feed="dental-practice" style="display: none;">Load More Articles</button>
            </section>

            <section class="section" data-feed="allon4-implants">
                <div class="section-header">
                    <h2 class="section-title">Allon4 Implant Dentures</h2>
                    <a href="https://www.reddit.com/r/Allon4ImplantDentures/" class="view-all" target="_blank">View All</a>
                </div>
                <div class="cards-container" id="allon4-implants-news">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading feed...</p>
                    </div>
                </div>
                <div class="mobile-carousel">
                    <div class="carousel-container" id="allon4-implants-carousel">
                        <!-- Mobile carousel content will be loaded here -->
                    </div>
                </div>
                <button class="section-load-more" data-feed="allon4-implants" style="display: none;">Load More Articles</button>
            </section>
            
            <!-- More feed sections will be added here -->
        </div>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Store all articles for searching
            let allArticles = [];
            let feedCount = 2; // Start count after default feeds
            // Track visible articles per feed
            const visibleArticles = {};
            // Store feed data
            const feedData = {};
            
            // Function to generate card HTML
            function generateCardHTML(item, searchTerm = '') {
                let title = item.title;
                let subtitle = item.description || item.subtitle || '';
                let tagsHTML = '';
                
                // --- Start of Image Logic ---
                let imageUrl = 'https://images.unsplash.com/photo-1588776814546-1ffcf47267a5?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'; // Default fallback
                
                // 1. Prioritize the enclosure URL if it exists
                if (item.enclosure?.url) {
                    imageUrl = item.enclosure.url;
                } else {
                    // 2. If no enclosure, parse the description HTML to find the first image
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = item.description;
                    const firstImage = tempDiv.querySelector('img');
                    if (firstImage && firstImage.src) {
                        imageUrl = firstImage.src;
                    }
                }
                // --- End of Image Logic ---
                
                if (item.tags && item.tags.length > 0) {
                    tagsHTML = item.tags.map(tag => {
                        if (searchTerm && tag.toLowerCase().includes(searchTerm.toLowerCase())) {
                            return `<span class="tag highlight">${tag}</span>`;
                        }
                        return `<span class="tag">${tag}</span>`;
                    }).join('');
                }
                
                // Highlight search term in title and subtitle
                if (searchTerm) {
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    title = title.replace(regex, '<span class="highlight">$1</span>');
                    subtitle = subtitle.replace(regex, '<span class="highlight">$1</span>');
                }
                
                // Format date
                let displayDate = item.pubDate || item.date || '';
                if (displayDate && typeof displayDate === 'string') {
                    try {
                        const dateObj = new Date(displayDate);
                        displayDate = dateObj.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        });
                    } catch (e) {
                        console.error('Error formatting date:', e);
                    }
                }
                
                return `
                    <div class="card" data-url="${item.link || item.url}">
                        <img src="${imageUrl}" 
                             alt="${title}" class="card-image" onerror="this.src='https://images.unsplash.com/photo-1588776814546-1ffcf47267a5?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'">
                        <div class="card-content">
                            <h3 class="card-title">${title}</h3>
                            <p class="card-subtitle">${subtitle}</p>
                            ${tagsHTML ? `<div class="tags">${tagsHTML}</div>` : ''}
                            <div class="card-meta">
                                <span>${displayDate}</span>
                                <span>${item.author || item.creator || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Function to fetch and parse RSS feed
            async function fetchRSSFeed(url, feedId) {
                try {
                    // Use a reliable CORS proxy to avoid cross-origin issues.
                    const encodedUrl = encodeURIComponent(url);
                    const response = await fetch(`https://api.allorigins.win/raw?url=${encodedUrl}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const text = await response.text();
                    const parser = new DOMParser();
                    const xml = parser.parseFromString(text, "text/xml");
                    
                    // Check for parsing errors
                    const parseError = xml.querySelector('parsererror');
                    if (parseError) {
                        throw new Error('Error parsing RSS feed');
                    }
                    
                    // Extract feed items
                    const items = xml.querySelectorAll('item, entry'); // Add 'entry' for Reddit feeds
                    const feedItems = [];
                    
                    items.forEach(item => {
                        const title = item.querySelector('title')?.textContent || 'No title';
                        const link = item.querySelector('link')?.getAttribute('href') || item.querySelector('link')?.textContent ||'#';
                        // Look for content:encoded first, then fall back to description for better image parsing
                        const description = item.querySelector('content')?.textContent || item.querySelector('content\\:encoded')?.textContent || item.querySelector('description')?.textContent || '';
                        const pubDate = item.querySelector('pubDate, updated')?.textContent || '';
                        const author = item.querySelector('author > name')?.textContent || item.querySelector('author')?.textContent || 
                                       item.querySelector('dc\\:creator')?.textContent || '';
                        const enclosure = item.querySelector('enclosure');
                        
                        feedItems.push({
                            title,
                            link,
                            description,
                            pubDate,
                            author,
                            enclosure: enclosure ? {
                                url: enclosure.getAttribute('url'),
                                type: enclosure.getAttribute('type')
                            } : null
                        });
                    });
                    
                    return feedItems;
                } catch (error) {
                    console.error('Error fetching RSS feed:', error);
                    throw error;
                }
            }
            
            // Function to load a feed with pagination
            async function loadFeed(feedId, url, searchTerm = '', initialLoad = true) {
                const container = document.getElementById(`${feedId}-news`);
                const carousel = document.getElementById(`${feedId}-carousel`);
                const loadMoreBtn = document.querySelector(`.section-load-more[data-feed="${feedId}"]`);
                
                if (!container || !carousel) return;
                
                // Show loading state on initial load
                if (initialLoad) {
                    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading feed content...</p></div>';
                    carousel.innerHTML = '';
                }
                
                try {
                    // Initialize visible articles for this feed if needed
                    if (initialLoad || !visibleArticles[feedId]) {
                        visibleArticles[feedId] = 9; // Show 9 articles initially
                    } else if (!initialLoad) {
                        // Load more articles
                        visibleArticles[feedId] += 9;
                    }
                    
                    // Fetch the RSS feed if we don't have data yet
                    if (!feedData[feedId]) {
                        feedData[feedId] = await fetchRSSFeed(url, feedId);
                    }
                    
                    // Filter by search term if provided
                    let filteredData = feedData[feedId];
                    if (searchTerm) {
                        filteredData = feedData[feedId].filter(item => containsSearchTerm(item, searchTerm));
                    }
                    
                    // Get the articles to show
                    const articlesToShow = filteredData.slice(0, visibleArticles[feedId]);
                    
                    container.innerHTML = '';
                    carousel.innerHTML = '';
                    
                    let results = 0;
                    
                    articlesToShow.forEach(item => {
                        container.innerHTML += generateCardHTML(item, searchTerm);
                        carousel.innerHTML += `<div class="carousel-card" data-url="${item.link || item.url}">${generateCardHTML(item, searchTerm)}</div>`;
                        results++;
                        if (initialLoad) { // Only add to allArticles on initial load to avoid duplicates
                           allArticles.push({...item, category: feedId});
                        }
                    });
                    
                    if (results === 0) {
                        container.innerHTML = '<div class="no-results">No articles match your search</div>';
                        if (loadMoreBtn) loadMoreBtn.style.display = 'none';
                    } else {
                        // Show or hide the load more button based on whether there are more articles
                        if (loadMoreBtn) {
                            if (filteredData.length > visibleArticles[feedId]) {
                                loadMoreBtn.style.display = 'block';
                            } else {
                                loadMoreBtn.style.display = 'none';
                            }
                        }
                    }
                    
                    // Add click events to the new cards
                    addCardClickEvents();
                } catch (error) {
                    console.error('Error loading feed:', error);
                    container.innerHTML = `<div class="error-message">Error loading feed: ${error.message}. Please check the URL and try again.</div>`;
                    if (loadMoreBtn) loadMoreBtn.style.display = 'none';
                }
            }
            
            // Function to load all feeds
            function loadFeeds(searchTerm = '') {
                // Clear previous articles
                allArticles = [];
                
                // Reset visible articles count when searching
                if (searchTerm) {
                    for (const feedId in visibleArticles) {
                        visibleArticles[feedId] = 9;
                    }
                }
                
                // Load each feed from the URL list
                const urlItems = document.querySelectorAll('.url-item');
                urlItems.forEach(item => {
                    const url = item.querySelector('.url-full').textContent;
                    const feedId = item.getAttribute('data-feed-id');
                    if(feedId && url){
                       loadFeed(feedId, url, searchTerm, !searchTerm);
                    }
                });
            }
            
            // Function to check if article contains search term
            function containsSearchTerm(article, searchTerm) {
                const term = searchTerm.toLowerCase();
                return (
                    article.title.toLowerCase().includes(term) ||
                    (article.description && article.description.toLowerCase().includes(term)) ||
                    (article.author && article.author.toLowerCase().includes(term))
                );
            }
            
            // Function to add click events to cards
            function addCardClickEvents() {
                // Desktop cards
                document.querySelectorAll('.card').forEach(card => {
                    card.addEventListener('click', function() {
                        const url = this.getAttribute('data-url');
                        if (url && url !== '#') {
                            window.open(url, '_blank');
                        }
                    });
                });
                
                // Mobile carousel cards
                document.querySelectorAll('.carousel-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const url = this.getAttribute('data-url');
                        if (url && url !== '#') {
                            window.open(url, '_blank');
                        }
                    });
                });
            }
            
            // Function to add a new RSS feed
            async function addNewFeed() {
                const urlInput = document.getElementById('new-rss-url');
                const url = urlInput.value.trim();
                
                if (!url) {
                    alert('Please enter a valid RSS URL');
                    return;
                }
                
                // Validate URL format
                try {
                    new URL(url);
                } catch (e) {
                    alert('Please enter a valid URL');
                    return;
                }
                
                // Create a unique ID for this feed
                const feedId = 'feed-' + (++feedCount);
                
                // Add to URL list with proper text truncation
                const urlList = document.getElementById('url-list');
                const urlItem = document.createElement('div');
                urlItem.className = 'url-item';
                urlItem.setAttribute('data-feed-id', feedId);
                urlItem.innerHTML = `
                    <span class="url-text">${url}</span>
                    <span class="url-full">${url}</span>
                    <div class="url-actions">
                        <button class="url-btn">View</button>
                        <button class="url-btn remove">Remove</button>
                    </div>
                `;
                urlList.appendChild(urlItem);
                
                // Create a new section for this feed
                const feedsContainer = document.getElementById('feeds-container');
                const section = document.createElement('section');
                section.className = 'section';
                section.setAttribute('data-feed', feedId);
                section.innerHTML = `
                    <div class="section-header">
                        <h2 class="section-title">New Feed ${feedCount}</h2>
                        <a href="${url}" class="view-all" target="_blank">View All</a>
                    </div>
                    
                    <div class="cards-container" id="${feedId}-news">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading feed content...</p>
                        </div>
                    </div>
                    
                    <div class="mobile-carousel">
                        <div class="carousel-container" id="${feedId}-carousel">
                            <!-- Mobile carousel content will be loaded here -->
                        </div>
                    </div>
                    
                    <button class="section-load-more" data-feed="${feedId}" style="display: none;">Load More Articles</button>
                `;
                feedsContainer.appendChild(section);
                
                // Add event listener for the load more button
                const loadMoreBtn = section.querySelector('.section-load-more');
                loadMoreBtn.addEventListener('click', function() {
                    loadFeed(feedId, url, '', false);
                });
                
                // Add event listener for the remove button
                urlItem.querySelector('.remove').addEventListener('click', function() {
                    urlItem.remove();
                    section.remove();
                    delete feedData[feedId];
                    delete visibleArticles[feedId];
                });
                
                // Load the new feed
                await loadFeed(feedId, url);
                
                // Clear the input
                urlInput.value = '';
            }
            
            // Initial load of the default feeds
            loadFeeds();
            
            // Set up search functionality
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    loadFeeds(this.value.trim());
                }, 300);
            });
            
            // Load more button functionality for individual sections
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('section-load-more')) {
                    const feedId = e.target.getAttribute('data-feed');
                    const urlItem = document.querySelector(`.url-item[data-feed-id="${feedId}"]`) || document.querySelector('.url-item'); // Fallback for default
                    if (urlItem) {
                        const url = urlItem.querySelector('.url-full').textContent;
                        loadFeed(feedId, url, '', false);
                    }
                }
            });
            
            // Add URL button functionality
            document.getElementById('add-url').addEventListener('click', addNewFeed);
            
            // Allow adding URL with Enter key
            document.getElementById('new-rss-url').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewFeed();
                }
            });
            
            // Remove URL functionality (delegated to document)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove')) {
                    const urlItem = e.target.closest('.url-item');
                    if (urlItem) {
                        const feedId = urlItem.getAttribute('data-feed-id');
                        if (feedId) {
                           const section = document.querySelector(`.section[data-feed="${feedId}"]`);
                            if (section) {
                                section.remove();
                            }
                            delete feedData[feedId];
                            delete visibleArticles[feedId];
                            urlItem.remove();
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>

